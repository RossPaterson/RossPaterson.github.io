!function(t){var e={};function n(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(r,s,function(e){return t[e]}.bind(null,s));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";function r(t){const e=document.getElementById(t);if(null===e)throw`No element "${t}"`;return e}function s(t){const e=r(t);if(!(e instanceof HTMLInputElement))throw`"${t}" is not an input element`;return e}function i(t){for(;t.lastChild;)t.removeChild(t.lastChild)}function o(t){return function(t,e){const n=document.createElement(t);for(const t of e)n.appendChild(t);return n}("ul",t.map(t=>a("li",t)))}function a(t,e){const n=document.createElement(t);return n.textContent=e,n}n.r(e);class h{constructor(t,e){this.head=t,this.tail=e}}function l(t){return e=>new h(t,e)}function c(t,e,n){for(;null!==e;){if(null===n)return!1;if(e===n)return!0;if(!t(e.head,n.head))return!1;e=e.tail,n=n.tail}return null===n}function u(t){return{[Symbol.iterator]:function*(){for(let e=t;null!==e;e=e.tail)yield e.head}}}function f(t,e){return{name:t,value:e}}function d(t,e){return{name:t,value:String(e)}}function m(t,e,n){const r=document.createElementNS("http://www.w3.org/2000/svg",t);for(const t of e)r.setAttribute(t.name,t.value);for(const t of n)r.appendChild(t);return r}function p(t,e){return m("g",[f("stroke",t),f("stroke-width","1"),f("stroke-linecap","round")],e)}function g(t,e,n,r){return m("line",[d("x1",t),d("y1",e),d("x2",n),d("y2",r)],[])}function y(t,e,n,r){const s=m("text",[d("x",t),d("y",e),f("text-anchor","middle"),f("fill",n)],[]);return s.textContent=r,s}const w=30,b=45,v=30,x=15,S=5,T=20,C=20,z="#0000cc",k="#dddddd",M="#cc0000",E="black",N="#aaaaaa",j="Îµ";class A{constructor(t,e){this.sym=t,this.children=e;let n=1,r=0;for(const t of u(e))n=Math.max(n,t.height()),r+=t.width();this.ht=n+1,this.wd=Math.max(1,r),this.sentence=Array.from(u(e),t=>t.getSentence()).join("")}height(){return this.ht}width(){return this.wd}getSentence(){return this.sentence}nonTerminal(){return this.sym}draw(t,e,n,r){const s=n+b;let i=[],o=e;for(const e of u(this.children))i.push(e.draw(t,o,s,r-1)),o+=e.width()*w;const a=i.length,h=0===a?e:(i[Math.floor((a-1)/2)]+i[Math.floor(a/2)])/2;t.push(y(h,n,M,this.sym));const l=n+S,c=s-x;return 0===a?(t.push(y(e,s,N,j)),t.push(p(N,[g(e,l,e,c)]))):t.push(p(E,i.map(t=>g(h,l,t,c)))),h}}class P{constructor(t){this.sym=t}height(){return 1}width(){return 1}getSentence(){return this.sym}draw(t,e,n,r){t.push(y(e,n,z,this.sym));const s=n+r*b-10;return t.push(y(e,s,z,this.sym)),t.push(p(k,[g(e,n+S,e,s-x)])),e}}function U(t,e){return t===e||(t instanceof P&&e instanceof P?t.sym===e.sym:t instanceof A&&e instanceof A&&(t.sym===e.sym&&c(U,t.children,e.children)))}function D(t,e){const n=t.getSentence(),r=e.getSentence();return n.length!==r.length?n.length-r.length:n<r?-1:n>r?1:t.height()-e.height()}function G(t){const e=t.width()*w,n=t.height()*b;let r=[];return r.push(m("rect",[d("width",e),d("height",n),f("fill","#fff7db")],[])),r.push(m("rect",[d("y",n),d("width",e),d("height",v),f("fill","#f0e6bc")],[])),t.draw(r,w/2,30,t.height()),m("svg",[d("width",e+T),d("height",n+v+C),f("xmlns","http://www.w3.org/2000/svg"),f("version","1.1"),f("font-family","sans-serif"),d("font-size",15)],r)}class O{constructor(t){this.value=t,this.next=null}}class _{constructor(){this.front=this.back=null}isEmpty(){return null===this.front}add(t){null===this.back?this.back=this.front=new O(t):this.back=this.back.next=new O(t)}remove(){const t=this.front;if(null!==t)return this.front=t.next,null===this.front&&(this.back=null),t.value;throw"empty queue"}}function I(t){if(!t)throw"precondition does not hold"}class q{constructor(t,e,n,r,s){this.nt=t,this.rhs=e,this.pos=n,this.parsed=r,this.finish=s}advance(t){return I(!this.finished()),new q(this.nt,this.rhs,this.pos-1,l(t)(this.parsed),this.finish)}equals(t){return t===this||this.finish===t.finish&&this.pos===t.pos&&this.nt===t.nt&&(e=this.rhs,n=t.rhs,e===n||e.length===n.length&&e.every((t,e)=>t===n[e]))&&c(U,this.parsed,t.parsed);var e,n}finished(){return 0===this.pos}finishedWith(t){return 0===this.pos&&this.nt===t}match(t){return this.pos>0&&this.rhs[this.pos-1]===t}current(){return I(!this.finished()),this.rhs[this.pos-1]}start(){return this.finish}complete(){return I(this.finished()),new A(this.nt,this.parsed)}completeTop(){if(I(this.finished()),null===this.parsed)throw"requires non-empty list";return I(null===this.parsed.tail),this.parsed.head}}function W(t,e,n){return new q(t,e,e.length,null,n)}const $="Start",B=100;class H{constructor(t,e){this.grammar=t,this.limit=e,this.count=0,this.expandCount=0,this.finished=!1,this.lgges=new Map;for(const e of t.nonTerminals())this.lgges.set(e,[])}expand(){let t=new Map;for(const e of this.grammar.nonTerminals()){let n=[];for(const t of this.grammar.expansions(e)){const r=this.expandSymbols(t);for(const t of r){const r=new A(e,t);if(n.push(r),this.count+=r.height()*r.width(),this.count>this.limit)return!1}}t.set(e,n)}let e=this.size();return this.lgges=t,this.expandCount++,this.size()===e&&(this.finished=!0),!0}expandSymbols(t){let e=[null];for(let n=t.length-1;n>=0;n--)e=this.expandSymbol(t[n],e);return e}expandSymbol(t,e){if(this.grammar.isTerminal(t)){const n=new P(t);return e.map(l(n))}{const n=this.lgges.get(t);let r=[];for(const t of n)for(const n of e)r.push(l(t)(n));return r}}expandToDepth(t){for(;this.expandCount<t&&!this.finished&&this.expand(););}derivations(t){return this.lgges.get(t)}depth(){return this.expandCount}size(){let t=0;for(const e of this.grammar.nonTerminals())t+=this.derivations(e).length;return t}complete(){return this.finished}}class L{constructor(){this.lhss=[],this.productions=new Map}addProduction(t,e){let n=this.productions.get(t);n?n.push(e):(this.lhss.push(t),this.productions.set(t,[e]))}getStart(){return this.lhss[0]}nonTerminals(){return this.lhss}isTerminal(t){return!this.productions.has(t)}isNonTerminal(t){return this.productions.has(t)}expansions(t){return this.productions.get(t)}}function F(t,e){for(const n of e)t.add(n)}class J{constructor(t){this.grammar=t,this.unreachable=this.computeUnreachable(),this.unrealizable=this.computeUnrealizable(),this.nullable=this.computeNullable(),this.cyclic=this.computeCyclic()}getUnreachable(){return this.unreachable}getUnrealizable(){return this.unrealizable}getNullable(){return this.nullable}getCyclic(){return this.cyclic}infinitelyAmbiguous(){for(const t of this.cyclic)if(!this.unreachable.has(t)&&!this.unrealizable.has(t))return!0;return!1}computeUnreachable(){let t=new Set,e=new _;for(e.add(this.grammar.getStart());!e.isEmpty();){const n=e.remove();if(!t.has(n)){t.add(n);for(const t of this.grammar.expansions(n))for(const n of t)this.grammar.isNonTerminal(n)&&e.add(n)}}return this.complement(t)}computeUnrealizable(){let t=new Set(this.grammar.nonTerminals());function e(e){return e.every(e=>!t.has(e))}let n=!0;for(;n;){n=!1;for(const r of t)if(this.grammar.expansions(r).some(e)){t.delete(r),n=!0;break}}return t}computeNullable(){let t=new Set;function e(e){return e.every(e=>t.has(e))}let n=!0;for(;n;){n=!1;for(const r of this.grammar.nonTerminals())if(!t.has(r)&&this.grammar.expansions(r).some(e)){t.add(r),n=!0;break}}return t}computeCyclic(){let t=this.directExpansion();return function(t){let e=!0;for(;e;){e=!1;for(const n of t.values()){const r=Array.from(n);for(const e of r){const r=t.get(e);r&&F(n,r)}n.size>r.length&&(e=!0)}}}(t),function(t){let e=new Set;for(const[n,r]of t.entries())r.has(n)&&e.add(n);return e}(t)}directExpansion(){let t=new Map;for(const e of this.grammar.nonTerminals()){let n=new Set;for(const t of this.grammar.expansions(e)){let e=0;for(let n of t)this.nullable.has(n)||e++;if(0===e)F(n,t);else if(1===e)for(const e of t)this.grammar.isNonTerminal(e)&&!this.nullable.has(e)&&n.add(e)}0!==n.size&&t.set(e,n)}return t}complement(t){let e=new Set;for(const n of this.grammar.nonTerminals())t.has(n)||e.add(n);return e}}const K=1e4;function Q([t,e]){return{lhs:s(t),rhs:s(e)}}function R(t){return t.split("|").map(V)}function V(t){return Array.from(t).filter(t=>" "!==t)}function X(t){const e=new J(t);let n=[];const r=e.getUnreachable(),s=e.getUnrealizable(),i=e.getCyclic();return r.size>0&&n.push(Y(r,"unreachable from the start symbol "+t.getStart())),s.size>0&&n.push(Y(s,"unrealizable (cannot generate any strings)")),i.size>0&&n.push(Y(i,e.infinitelyAmbiguous()?"cyclic, so some strings have infinitely many derivations":"cyclic")),n}function Y(t,e){const n=t.size>1;return(n?"Nonterminals ":"Nonterminal ")+Array.from(t).join(", ")+(n?" are ":" is ")+e+"."}window.GrammarExplorer=class{constructor(t,e,n){this.rules=t.map(Q),this.errors=r(e),this.gallery=r(n);const s=t=>{13==t.keyCode&&this.allDerivations()};for(const t of this.rules)t.rhs.onkeydown=s}getGrammar(){let t=new L;for(const e of this.rules){const n=e.lhs.value,r=e.rhs.value;if(""!==n)for(const e of R(r))t.addProduction(n,e)}return t}reportIssues(t){i(this.errors),t.length>0&&(this.errors.appendChild(a("p","This grammar has the following problems:")),this.errors.appendChild(o(t)))}setTreeGallery(t,e){const n=this.gallery;i(n),n.appendChild(a("h2",t)),e.sort(D);for(const t of e)n.appendChild(G(t))}allDerivations(){const t=this.getGrammar();this.reportIssues(X(t));const e=t.nonTerminals().length+9,n=new H(t,K);n.expandToDepth(e);const r=n.derivations(t.getStart()),s=n.complete()?"All derivation trees":"Derivation trees of depth at most "+n.depth();this.setTreeGallery(s,r)}},window.SentenceParser=class{constructor(t,e){this.grammarSrc=t,this.sentence=s(e),this.sentence.onkeydown=t=>{13==t.keyCode&&this.deriveSentence()}}deriveSentence(){const t=this.grammarSrc.getGrammar();this.grammarSrc.reportIssues(X(t));const e=this.sentence.value,n=function(t,e){let n=function(t){let e=[];for(let n=0;n<t;n++)e.push([]);return e}(e.length+1),r=!1;for(let s=e.length;s>=0;s--){let i=new _;if(s===e.length)i.add(W($,[t.getStart()],s));else{const r=e[s];if(t.isTerminal(r)){const t=new P(r);for(const e of n[s+1])e.match(r)&&i.add(e.advance(t))}}const o=n[s];let a=[];for(;!i.isEmpty();){if(o.length>B){r=!0;break}const e=i.remove();if(!o.some(t=>t.equals(e)))if(o.push(e),e.finished()){const t=e.complete(),r=t.nonTerminal(),o=e.start();o===s&&a.push(t);for(const e of n[o])e.match(r)&&i.add(e.advance(t))}else{const n=e.current();if(t.isNonTerminal(n)){for(const e of t.expansions(n))i.add(W(n,e,s));for(const t of a)t.nonTerminal()===n&&i.add(e.advance(t))}}}n[s]=o}let s=[];for(const t of n[0])t.finishedWith($)&&s.push(t.completeTop());return{complete:!r,trees:s}}(t,V(e)),r=(n.complete?0==n.trees.length?"There are no derivations":1==n.trees.length?"Derivation tree":"Derivation trees":"Some of the derivations")+" for '"+e+"'";this.grammarSrc.setTreeGallery(r,n.trees)}}}]);